@page "/"

<!--
<h1>蹭饭地图</h1>
<a>蹭饭即正义。</a>
-->
<h1>@(programConfigFile.Configs[KnownProgramConfigKeys.TotalTitle])</h1>
<a>@(programConfigFile.Configs[KnownProgramConfigKeys.SecondaryTitle])</a>

<hr />
<Latency />

<div class="input-group mb-3 pull-right">
    <!-- <span class="oi oi-eye-open" aria-hidden="true" /> --> 
    <div class="input-group-prepend">
        <span class="input-group-text" id="appendedInputButtons"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16"><path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/><path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/></svg>&nbsp;视图：</span>
    </div>
    
    <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-collection" viewBox="0 0 16 16"><path d="M2.5 3.5a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-11zm2-2a.5.5 0 0 1 0-1h7a.5.5 0 0 1 0 1h-7zM0 13a1.5 1.5 0 0 0 1.5 1.5h13A1.5 1.5 0 0 0 16 13V6a1.5 1.5 0 0 0-1.5-1.5h-13A1.5 1.5 0 0 0 0 6v7zm1.5.5A.5.5 0 0 1 1 13V6a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-13z"/></svg>
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-filter-left" viewBox="0 0 16 16"><path d="M2 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/></svg>
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list-ul" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/></svg>
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list-nested" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.5 11.5A.5.5 0 0 1 5 11h10a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 3 7h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm-2-4A.5.5 0 0 1 1 3h10a.5.5 0 0 1 0 1H1a.5.5 0 0 1-.5-.5z"/></svg>
    <span class="oi oi-inbox" aria-hidden="true" /> -->
	<button class=@InBoxButtonClass type="button" @onclick="InBoxButton_Click"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-collection" viewBox="0 0 16 16"><path d="M2.5 3.5a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-11zm2-2a.5.5 0 0 1 0-1h7a.5.5 0 0 1 0 1h-7zM0 13a1.5 1.5 0 0 0 1.5 1.5h13A1.5 1.5 0 0 0 16 13V6a1.5 1.5 0 0 0-1.5-1.5h-13A1.5 1.5 0 0 0 0 6v7zm1.5.5A.5.5 0 0 1 1 13V6a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-13z"/></svg>@InBoxButtonText</button>

	<!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-list" viewBox="0 0 16 16"><path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/><path d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8zm0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-1-5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zM4 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm0 2.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"/></svg>
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-archive" viewBox="0 0 16 16"><path d="M0 2a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1v7.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 12.5V5a1 1 0 0 1-1-1V2zm2 3v7.5A1.5 1.5 0 0 0 3.5 14h9a1.5 1.5 0 0 0 1.5-1.5V5H2zm13-3H1v2h14V2zM5 7.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/></svg>
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-back" viewBox="0 0 16 16"><path d="M0 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v2h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2H2a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H2z"/></svg>
    <span class="oi oi-th" aria-hidden="true" /> -->
    <div class="input-group-append">
        <button class=@DirectButtonClass type="button" @onclick="DirectButton_Click"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-list" viewBox="0 0 16 16"><path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/><path d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8zm0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-1-5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zM4 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm0 2.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"/></svg>@DirectButtonText</button>
    </div>
</div>
@if (showGGG)
{
    <div class="alert alert-warning">
        <span>咕（开）咕（发）咕（中）。</span>
    </div>
}

@foreach(MapConfigItem mapConfigItem in mapConfigFile.MapConfigItems)
{
    <PictureSet_Map Title="@(mapConfigItem.Title)" FooterComment="@(mapConfigItem.FooterComment)" MapWidth=@(double.Parse(mapConfigItem.Width)) MapHeight=@(double.Parse(mapConfigItem.Height)) ViewMode=@ViewMode PictureItemDictionaty=@(sourceConfigFile.PictureItemStructureDictionary) BigInfoSet=@(sourceConfigFile.BigInfos) LocationFilter=@(mapConfigItem.LocationFilter) />
}

@code{
    #warning 加个密码
	#warning 这里应当可以通过配置来选择显示国家。

    private MapViewMode viewMode = MapViewMode.Direct;
    [Parameter]
    public MapViewMode ViewMode
    {
        get{ return viewMode; }
        set
        {
            if (viewMode != value)
            {
                viewMode=value;
                StateHasChanged();
            }
        }
    }

    [Parameter]
    public string ProgramConfigSrc { get; set; } = "wwwroot/config/ProgramConfig.csv";
    private ProgramConfigFile programConfigFile = null;

    [Parameter]
    public string SourceConfigSrc { get; set; } = "wwwroot/config/SourceConfig.csv";
    private SourceConfigFile sourceConfigFile = null;

    [Parameter]
    public string MapConfigSrc { get; set; } = "wwwroot/config/MapConfig.csv";
    private MapConfigFile mapConfigFile = null;

    protected override void OnInitialized()
    {
        base.OnInitialized();

        programConfigFile=new ProgramConfigFile();
        programConfigFile.Load(ProgramConfigSrc);

        sourceConfigFile=new SourceConfigFile();
        sourceConfigFile.Load(SourceConfigSrc);

        mapConfigFile=new MapConfigFile();
        mapConfigFile.Load(MapConfigSrc);
    }

    private string InBoxButtonClass
    {
        get { return "btn btn-primary" + (ViewMode == MapViewMode.InBox ? " active" : ""); }
    }
    private string InBoxButtonText
    {
        get { return " 收纳盒" + (ViewMode == MapViewMode.InBox ? " ●" : ""); }
    }

    private bool showGGG = false;
    private void InBoxButton_Click()
    {
#if DEBUG
        ViewMode = MapViewMode.InBox;
#else
        showGGG = true;
        StateHasChanged();
#endif
    }

    private string DirectButtonClass
    {
        get { return "btn btn-primary" + (ViewMode == MapViewMode.Direct ? " active" : ""); }
    }
    private string DirectButtonText
    {
        get { return " 直接呈现" + (ViewMode == MapViewMode.Direct ? " ●" : ""); }
    }

    private void DirectButton_Click()
    {
#if DEBUG
        ;
#else
        showGGG = false;
#endif
        ViewMode = MapViewMode.Direct;
    }
}